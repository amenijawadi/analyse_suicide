---
title: "Chapitre 3 : Analyse Temporelle "
format:
  html:
    code-fold: true
---

# √âvolution Temporelle des Suicides

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
library(plotly)
library(knitr)
library(forecast)
library(zoo)

# Charger les donn√©es nettoy√©es
data <- readRDS("data/suicide_data_clean.rds")

theme_set(theme_minimal(base_size = 12))
```

## Tendance Globale 1980-2015




### √âvolution du taux de suicide (pour 100k habitants)
```{r trend_rate}
trend_yearly <- data %>% 
  group_by(year) %>% 
  summarise(
    total_suicides = sum(suicides_no),
    total_population = sum(population),
    taux_moyen = (total_suicides / total_population) * 100000,
    .groups = "drop"
  )

p2 <- ggplot(trend_yearly, aes(x = year, y = taux_moyen)) +
  geom_area(fill = "coral", alpha = 0.3) +
  geom_line(color = "darkred", size = 1.2) +
  geom_point(color = "darkred", size = 2) +
  scale_x_continuous(breaks = seq(1980, 2015, 5)) +
  labs(title = "√âvolution du taux de suicide mondial",
       subtitle = "Pour 100 000 habitants",
       x = "Ann√©e",
       y = "Taux pour 100k habitants") +
  theme_minimal()

ggplotly(p2)
```



### Statistiques descriptives par d√©cennie
```{r stats_decennie}
data %>% 
  group_by(decennie) %>% 
  summarise(
    `Nombre de suicides` = sum(suicides_no),
    `Population totale` = sum(population),
    `Taux moyen (100k)` = (sum(suicides_no) / sum(population)) * 100000,
    `Taux min` = min(taux_suicide_100k),
    `Taux max` = max(taux_suicide_100k),
    .groups = "drop"
  ) %>% 
  kable(digits = 2, format.args = list(big.mark = " "),
        caption = "Statistiques par d√©cennie")
```

## Analyse des Variations Annuelles

### Taux de croissance annuel
```{r growth_rate}
trend_yearly <- trend_yearly %>% 
  mutate(
    variation_pct = (total_suicides - lag(total_suicides)) / lag(total_suicides) * 100,
    variation_abs = total_suicides - lag(total_suicides)
  )

# Graphique des variations
ggplot(trend_yearly %>% filter(!is.na(variation_pct)), 
       aes(x = year, y = variation_pct)) +
  geom_col(aes(fill = variation_pct > 0), alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("TRUE" = "darkred", "FALSE" = "darkgreen"),
                    labels = c("Diminution", "Augmentation")) +
  scale_x_continuous(breaks = seq(1980, 2015, 5)) +
  labs(title = "Variation annuelle du nombre de suicides",
       subtitle = "Taux de croissance par rapport √† l'ann√©e pr√©c√©dente",
       x = "Ann√©e",
       y = "Variation (%)",
       fill = "Type") +
  theme_minimal()
```


**Analyse par p√©riodes :**

üî¥ D√©but des ann√©es 1980

On observe des augmentations tr√®s fortes, avec des pics sup√©rieurs √† +50 %.

Cela indique une forte instabilit√© du ph√©nom√®ne au d√©but de la p√©riode (possibles changements sociaux, √©conomiques ou qualit√© des donn√©es).

üü¢ Milieu des ann√©es 1980

Une chute importante (environ -30 %), suivie d‚Äôune stabilisation.

Cela sugg√®re une r√©duction notable du nombre de suicides apr√®s les pics initiaux.

üü¢ Ann√©es 1990 ‚Äì d√©but 2000

Les variations sont faibles, proches de 0 %.

Alternance de petites hausses et baisses ‚Üí stabilit√© relative du ph√©nom√®ne.

üü¢ Ann√©es 2005 ‚Äì 2014

Tendance globalement n√©gative (plus de barres vertes).

Cela traduit une diminution progressive du nombre de suicides.



**Conclusion:**

Le ph√©nom√®ne est tr√®s instable au d√©but de la p√©riode.

Il devient plus stable √† partir des ann√©es 1990.

Une tendance √† la baisse est visible dans les ann√©es r√©centes.





### Identification des ann√©es critiques
```{r critical_years}
# Ann√©es avec plus forte hausse
top_hausses <- trend_yearly %>% 
  filter(!is.na(variation_pct)) %>% 
  arrange(desc(variation_pct)) %>% 
  head(5) %>% 
  select(year, total_suicides, variation_pct, variation_abs)

# Ann√©es avec plus forte baisse
top_baisses <- trend_yearly %>% 
  filter(!is.na(variation_pct)) %>% 
  arrange(variation_pct) %>% 
  head(5) %>% 
  select(year, total_suicides, variation_pct, variation_abs)

cat("=== TOP 5 HAUSSES ===\n")
print(kable(top_hausses, digits = 2, 
            col.names = c("Ann√©e", "Total suicides", "Variation %", "Variation absolue")))

cat("\n=== TOP 5 BAISSES ===\n")
print(kable(top_baisses, digits = 2,
            col.names = c("Ann√©e", "Total suicides", "Variation %", "Variation absolue")))
```


Le tableau des top 5 hausses montre les ann√©es o√π le nombre de suicides a connu les plus fortes augmentations .
En 1980 et 1985 enregistrent des hausses importantes de +65‚ÄØ% et +58‚ÄØ%, soit respectivement 60‚ÄØ610 et 72‚ÄØ851 suicides . Ces ann√©es peuvent correspondre √† des √©v√©nements sociaux, √©conomiques ou politiques ayant pu influencer le taux de suicide.

Le tableau des top 5 baisses met en √©vidence les ann√©es o√π le nombre de suicides a le plus diminu√©. La plus forte baisse est observ√©e en 2016 avec un recul de 92‚ÄØ% (soit 191‚ÄØ389 suicides en moins), suivie de 1983 et 2015. Ces ann√©es repr√©sentent des p√©riodes critiques o√π des facteurs protecteurs, des interventions ou des changements d√©mographiques ont pu r√©duire drastiquement le nombre de suicides.

En r√©sum√©, l‚Äôidentification de ces ann√©es critiques permet de rep√©rer les tendances exceptionnelles dans la s√©rie temporelle et de cibler les p√©riodes n√©cessitant une analyse plus approfondie.

## Comparaison par P√©riodes

### Analyse pr√©-2000 vs post-2000
```{r pre_post_2000}
data_comparison <- data %>% 
  mutate(periode = if_else(year < 2000, "1980-1999", "2000-2015")) %>% 
  group_by(periode) %>% 
  summarise(
    `Nombre total` = sum(suicides_no),
    `Population` = sum(population),
    `Taux moyen (100k)` = (sum(suicides_no) / sum(population)) * 100000,
    `Nombre d'ann√©es` = n_distinct(year),
    `Moyenne annuelle` = sum(suicides_no) / n_distinct(year),
    .groups = "drop"
  )

kable(data_comparison, digits = 2, format.args = list(big.mark = " "),
      caption = "Comparaison pr√©-2000 vs post-2000")

# Message explicatif sous le tableau
cat("\n**Interpr√©tation :**\n")
cat("- Le nombre total de suicides est l√©g√®rement plus bas apr√®s 2000.\n")
cat("- Le taux moyen pour 100k habitants a diminu√© de 13,99 √† 12,17.\n")
cat("  ‚Üí proportionnellement, moins de suicides par population.\n")
cat("- La moyenne annuelle est plus √©lev√©e apr√®s 2000, car la population a augment√©.\n\n")


# Test de significativit√©
t_test_result <- data %>% 
  mutate(periode = if_else(year < 2000, "Pre2000", "Post2000")) %>% 
  group_by(year, periode) %>% 
  summarise(taux_annuel = sum(suicides_no) / sum(population) * 100000, .groups = "drop") %>% 
  {t.test(taux_annuel ~ periode, data = .)}

cat("\n=== Test t de Student ===\n")
cat("t =", round(t_test_result$statistic, 3), "\n")
cat("p-value =", format.pval(t_test_result$p.value, digits = 3), "\n")
cat("Diff√©rence significative :", 
    ifelse(t_test_result$p.value < 0.05, "OUI ‚úì", "NON ‚úó"), "\n")


```

Le t-test compare la moyenne annuelle des taux de suicide par 100k habitants entre les deux p√©riodes pour voir si la diff√©rence est statistiquement significative.
 R√©sultats du test : t = -5.018
  ‚Üí La statistique t n√©gative signifie que le taux moyen post-2000 est plus bas que le taux pr√©-2000. p-value = 1.6e-05 ‚Üí Tr√®s petite valeur, bien en dessous de 0.05, ce qui signifie que la diff√©rence n‚Äôest pas due au hasard. 
 Diff√©rence significative : OUI ‚úì
  ‚Üí On peut conclure qu‚Äôil y a une diff√©rence statistiquement significative entre les taux de suicide pr√©-2000 et post-2000.

## √âvolution par D√©cennie
```{r evolution_decennie}
data %>% 
  group_by(decennie) %>% 
  summarise(
    total = sum(suicides_no),
    taux = (sum(suicides_no) / sum(population)) * 100000,
    .groups = "drop"
  ) %>% 
  ggplot(aes(x = decennie, y = taux, fill = decennie)) +
  geom_col(alpha = 0.8) +
  geom_text(aes(label = round(taux, 1)), vjust = -0.5, size = 4) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Taux de suicide par d√©cennie",
       x = "D√©cennie",
       y = "Taux pour 100k habitants") +
  theme_minimal() +
  theme(legend.position = "none")
```



## Conclusions de l'Analyse Temporelle
```{r summary_temporal}
# Calculs pour le r√©sum√©
variation_totale <- ((tail(trend_yearly$total_suicides, 1) - 
                      head(trend_yearly$total_suicides, 1)) / 
                     head(trend_yearly$total_suicides, 1)) * 100

taux_1980 <- trend_yearly$taux_moyen[trend_yearly$year == 1980]
taux_2015 <- trend_yearly$taux_moyen[trend_yearly$year == 2015]
variation_taux <- taux_2015 - taux_1980

annee_max <- trend_yearly$year[which.max(trend_yearly$total_suicides)]
annee_min <- trend_yearly$year[which.min(trend_yearly$total_suicides)]
```

**Points cl√©s identifi√©s :**

1.  **Tendance g√©n√©rale** : Variation de `r round(variation_totale, 1)`% entre 1980 et 2015

2.  **Pic historique** : Ann√©e `r annee_max` avec `r format(max(trend_yearly$total_suicides), big.mark = " ")` suicides

3.  **Point bas** : Ann√©e `r annee_min` avec `r format(min(trend_yearly$total_suicides), big.mark = " ")` suicides

4.  **√âvolution du taux** : 
   - 1980 : `r round(taux_1980, 2)` pour 100k habitants
   - 2015 : `r round(taux_2015, 2)` pour 100k habitants
   - Variation : `r round(variation_taux, 2)` points

5.  **P√©riodes critiques** : 
   - D√©cennie la plus touch√©e : `r data %>% group_by(decennie) %>% summarise(total = sum(suicides_no)) %>% arrange(desc(total)) %>% slice(1) %>% pull(decennie)`


