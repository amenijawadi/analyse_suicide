---
title: "Chapitre 6 : Analyse G√©ographique"
format:
  html:
    code-fold: true
---

# Analyse par Pays et R√©gions

```{r setup, message=FALSE, warning=FALSE}
# Installer les packages manquants si n√©cessaire
if (!require("fields")) install.packages("fields", repos = "https://cran.rstudio.com/")
if (!require("rworldmap")) install.packages("rworldmap", repos = "https://cran.rstudio.com/")

library(tidyverse)
library(scales)
library(plotly)
library(knitr)
library(DT)
library(ggrepel)
library(maps)
library(rworldmap)

data <- readRDS("data/suicide_data_clean.rds")
theme_set(theme_minimal(base_size = 12))
```

## Vue d'Ensemble Mondiale

### Nombre de pays dans l'analyse
```{r overview_countries}
n_pays <- n_distinct(data$country)
n_observations_par_pays <- data %>% 
  count(country) %>% 
  summarise(
    minimum = min(n),
    mediane = median(n),
    moyenne = mean(n),
    maximum = max(n)
  )

cat(" Nombre total de pays analys√©s :", n_pays, "\n\n")
cat("**Observations par pays** :\n")
cat("  - Minimum :", n_observations_par_pays$minimum, "\n")
cat("  - M√©diane :", n_observations_par_pays$mediane, "\n")
cat("  - Moyenne :", round(n_observations_par_pays$moyenne, 1), "\n")
cat("  - Maximum :", n_observations_par_pays$maximum, "\n")
```

### Couverture temporelle par pays
```{r temporal_coverage}
coverage <- data %>% 
  group_by(country) %>% 
  summarise(
    annee_debut = min(year),
    annee_fin = max(year),
    nb_annees = n_distinct(year),
    completude = (nb_annees / 36) * 100,
    .groups = "drop"
  ) %>% 
  arrange(desc(completude))

# Statistiques de couverture
cat("Couverture temporelle :\n")
cat("  - Pays avec couverture compl√®te (36 ans) :", 
    sum(coverage$nb_annees == 36), "\n")
cat("  - Pays avec > 80% de couverture :", 
    sum(coverage$completude > 80), "\n")
cat("  - Pays avec < 50% de couverture :", 
    sum(coverage$completude < 50), "\n")


```

## Classement des Pays par Taux de Suicide

### Top 20 pays avec les taux les plus √©lev√©s
```{r top20_pays}
top20_pays <- data %>% 
  group_by(country) %>% 
  summarise(
    total_suicides = sum(suicides_no),
    total_population = sum(population),
    taux_moyen = (total_suicides / total_population) * 100000,
    .groups = "drop"
  ) %>% 
  arrange(desc(taux_moyen)) %>% 
  head(20)

kable(top20_pays, 
      digits = 2,
      format.args = list(big.mark = " "),
      col.names = c("Pays", "Total suicides", "Population totale", "Taux moyen (100k)"),
      caption = "Top 20 des pays avec les taux de suicide les plus √©lev√©s")

# Visualisation
ggplot(top20_pays, aes(x = reorder(country, taux_moyen), y = taux_moyen)) +
  geom_segment(aes(x = reorder(country, taux_moyen), 
                   xend = reorder(country, taux_moyen),
                   y = 0, yend = taux_moyen),
               color = "grey50", size = 1) +
  geom_point(size = 4, color = "#F44336") +
  coord_flip() +
  labs(title = "Top 20 des pays avec les taux de suicide les plus √©lev√©s",
       subtitle = "Taux moyen 1980-2015 pour 100 000 habitants",
       x = NULL,
       y = "Taux pour 100k habitants") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10, face = "bold"))
```

### Bottom 20 pays avec les taux les plus faibles
```{r bottom20_pays}
bottom20_pays <- data %>% 
  group_by(country) %>% 
  summarise(
    total_suicides = sum(suicides_no),
    total_population = sum(population),
    taux_moyen = (total_suicides / total_population) * 100000,
    .groups = "drop"
  ) %>% 
  arrange(taux_moyen) %>% 
  head(20)

kable(bottom20_pays, 
      digits = 2,
      format.args = list(big.mark = " "),
      col.names = c("Pays", "Total suicides", "Population totale", "Taux moyen (100k)"),
      caption = "Top 20 des pays avec les taux de suicide les plus faibles")

# Visualisation
ggplot(bottom20_pays, aes(x = reorder(country, -taux_moyen), y = taux_moyen)) +
  geom_segment(aes(x = reorder(country, -taux_moyen), 
                   xend = reorder(country, -taux_moyen),
                   y = 0, yend = taux_moyen),
               color = "grey50", size = 1) +
  geom_point(size = 4, color = "#4CAF50") +
  coord_flip() +
  labs(title = "Top 20 des pays avec les taux de suicide les plus faibles",
       subtitle = "Taux moyen 1980-2015 pour 100 000 habitants",
       x = NULL,
       y = "Taux pour 100k habitants") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10, face = "bold"))
```

## Comparaison par Continents/R√©gions

### Cr√©ation de groupes g√©ographiques
```{r regions}
# D√©finir les r√©gions (simplifi√©es)
data_regions <- data %>% 
  mutate(
    region = case_when(
      country %in% c("France", "Germany", "United Kingdom", "Italy", "Spain", 
                     "Poland", "Netherlands", "Belgium", "Greece", "Portugal",
                     "Austria", "Switzerland", "Sweden", "Norway", "Finland",
                     "Denmark", "Ireland", "Czech Republic", "Hungary", "Romania",
                     "Bulgaria", "Croatia", "Serbia", "Slovakia", "Slovenia") ~ "Europe",
      
      country %in% c("United States", "Canada", "Mexico", "Costa Rica", "Panama",
                     "Cuba", "Puerto Rico") ~ "Am√©rique du Nord",
      
      country %in% c("Brazil", "Argentina", "Chile", "Colombia", "Venezuela",
                     "Peru", "Ecuador", "Uruguay", "Paraguay") ~ "Am√©rique du Sud",
      
      country %in% c("China", "Japan", "South Korea", "India", "Thailand",
                     "Philippines", "Singapore", "Malaysia", "Indonesia",
                     "Vietnam", "Sri Lanka", "Myanmar") ~ "Asie",
      
      country %in% c("Australia", "New Zealand") ~ "Oc√©anie",
      
      country %in% c("South Africa", "Mauritius", "Seychelles") ~ "Afrique",
      
      country %in% c("Russia", "Ukraine", "Belarus", "Kazakhstan", "Azerbaijan",
                     "Armenia", "Georgia", "Kyrgyzstan", "Uzbekistan") ~ "Europe de l'Est/Asie Centrale",
      
      country %in% c("Israel", "Kuwait", "Qatar", "Bahrain", "United Arab Emirates",
                     "Turkey") ~ "Moyen-Orient",
      
      TRUE ~ "Autre"
    )
  )

# Statistiques par r√©gion
stats_regions <- data_regions %>% 
  group_by(region) %>% 
  summarise(
    nb_pays = n_distinct(country),
    total_suicides = sum(suicides_no),
    population = sum(population),
    taux_moyen = (total_suicides / population) * 100000,
    .groups = "drop"
  ) %>% 
  arrange(desc(taux_moyen))

kable(stats_regions, 
      digits = 2,
      format.args = list(big.mark = " "),
      caption = "Statistiques par r√©gion g√©ographique")
```

### Visualisation par r√©gion
```{r viz_regions}
# Graphique en barres
ggplot(stats_regions, aes(x = reorder(region, taux_moyen), y = taux_moyen, fill = region)) +
  geom_col(alpha = 0.8) +
  geom_text(aes(label = round(taux_moyen, 1)), hjust = -0.2, size = 4, fontface = "bold") +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  labs(title = "Taux de suicide moyen par r√©gion du monde",
       x = NULL,
       y = "Taux pour 100k habitants") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.y = element_text(size = 11, face = "bold"))


```

## Carte Mondiale des Taux de Suicide

### Pr√©paration des donn√©es cartographiques
```{r world_map_data}
# Calculer les taux moyens par pays
map_data <- data %>% 
  group_by(country) %>% 
  summarise(
    taux_moyen = (sum(suicides_no) / sum(population)) * 100000,
    .groups = "drop"
  )

# Harmoniser les noms de pays pour jointure avec la carte
map_data <- map_data %>% 
  mutate(country_map = case_when(
    country == "United States" ~ "USA",
    country == "United Kingdom" ~ "UK",
    country == "Russia" ~ "Russian Federation",
    country == "South Korea" ~ "South Korea",
    TRUE ~ country
  ))

# Joindre avec les donn√©es mondiales
world_map <- map_data("world")
world_data <- world_map %>% 
  left_join(map_data, by = c("region" = "country_map"))
```

### Carte choropl√®the mondiale
```{r choropleth_map}
ggplot(world_data, aes(x = long, y = lat, group = group, fill = taux_moyen)) +
  geom_polygon(color = "white", size = 0.1) +
  scale_fill_gradient2(
    low = "#2E7D32",
    mid = "#FFC107", 
    high = "#C62828",
    midpoint = 15,
    na.value = "grey90",
    name = "Taux\n(100k hab.)"
  ) +
  labs(title = "Carte mondiale des taux de suicide",
       subtitle = "Moyenne 1980-2015 pour 100 000 habitants",
       x = NULL,
       y = NULL) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    legend.position = "right"
  )
```

## Analyse des Disparit√©s G√©ographiques



### Comparaison pays d√©velopp√©s vs en d√©veloppement
```{r developed_vs_developing}
# Classification simplifi√©e (√† adapter selon vos crit√®res)
data_dev <- data %>% 
  mutate(
    developpement = case_when(
      country %in% c("United States", "Canada", "United Kingdom", "France", 
                     "Germany", "Italy", "Spain", "Japan", "Australia", 
                     "Netherlands", "Belgium", "Switzerland", "Sweden", 
                     "Norway", "Finland", "Denmark", "Austria", "New Zealand",
                     "South Korea", "Singapore", "Israel") ~ "D√©velopp√©s",
      TRUE ~ "En d√©veloppement"
    )
  )

# Comparaison
comparison_dev <- data_dev %>% 
  group_by(developpement) %>% 
  summarise(
    nb_pays = n_distinct(country),
    taux_moyen = mean(taux_suicide_100k),
    taux_median = median(taux_suicide_100k),
    ecart_type = sd(taux_suicide_100k),
    .groups = "drop"
  )

kable(comparison_dev, digits = 2,
      caption = "Comparaison pays d√©velopp√©s vs en d√©veloppement")

# Boxplot comparatif
ggplot(data_dev, aes(x = developpement, y = taux_suicide_100k, fill = developpement)) +
  geom_boxplot(outlier.alpha = 0.3) +
  geom_violin(alpha = 0.3) +
  scale_y_log10() +
  scale_fill_manual(values = c("D√©velopp√©s" = "#2196F3", "En d√©veloppement" = "#FF9800")) +
  labs(title = "Distribution des taux : Pays d√©velopp√©s vs En d√©veloppement",
       x = NULL,
       y = "Taux pour 100k habitants (log10)") +
  theme_minimal() +
  theme(legend.position = "none")
```




## Conclusions de l'Analyse G√©ographique
```{r summary_geo}
# Statistiques finales
pays_max <- top20_pays %>% slice(1) %>% pull(country)
taux_max_pays <- top20_pays %>% slice(1) %>% pull(taux_moyen)
pays_min <- bottom20_pays %>% slice(1) %>% pull(country)
taux_min_pays <- bottom20_pays %>% slice(1) %>% pull(taux_moyen)
region_max <- stats_regions %>% slice(1) %>% pull(region)
```

**Points cl√©s identifi√©s :**

1. üåç **Couverture g√©ographique** : `r n_pays` pays analys√©s sur tous les continents

2. üî¥ **Pays le plus touch√©** : **`r pays_max`** avec un taux moyen de `r round(taux_max_pays, 2)` pour 100k habitants

3. üü¢ **Pays le moins touch√©** : **`r pays_min`** avec un taux moyen de `r round(taux_min_pays, 2)` pour 100k habitants

4. üó∫Ô∏è **R√©gion la plus touch√©e** : **`r region_max`** pr√©sente les taux moyens les plus √©lev√©s

5. üìà **Tendances divergentes** : 
   - Certains pays montrent des hausses pr√©occupantes
   - D'autres affichent des baisses encourageantes
   - Les politiques nationales jouent un r√¥le d√©terminant

6. üåê **Facteurs g√©ographiques** : Les taux varient consid√©rablement selon :
   - Le niveau de d√©veloppement √©conomique
   - Les facteurs culturels et religieux
   - Les syst√®mes de sant√© mentale
   - La qualit√© des donn√©es de surveillance


**Interpr√©tation :** L'analyse g√©ographique r√©v√®le d'importantes disparit√©s mondiales. Les pays d'Europe de l'Est et certaines r√©gions d'Asie pr√©sentent historiquement les taux les plus √©lev√©s. Les diff√©rences observ√©es refl√®tent des r√©alit√©s socio-√©conomiques, culturelles et sanitaires complexes qui n√©cessitent des approches de pr√©vention adapt√©es √† chaque contexte national.